{
  "version": 3,
  "sources": ["../src/webpack-loader.ts"],
  "sourcesContent": ["import { transformSync } from \"@babel/core\";\nimport locatorPlugin from \"./babel-jsx/index.js\";\n\ninterface LocatorLoaderOptions {\n  env?: string;\n  ignoreComponentNames?: string[];\n}\n\ninterface SourceMap {\n  version: number;\n  sources: string[];\n  mappings: string;\n  file?: string;\n  sourceRoot?: string;\n  sourcesContent?: string[];\n  names?: string[];\n}\n\ninterface LoaderContext<T = Record<string, unknown>> {\n  async(): (err: Error | null, content?: string, sourceMap?: SourceMap) => void;\n  getOptions(): T;\n  resourcePath: string;\n}\n\n/**\n * Webpack loader for @locator/babel-jsx plugin\n *\n * This loader applies the LocatorJS babel transformation to JSX/TSX files,\n * enabling component location tracking for projects using SWC or Turbopack\n * where direct babel plugin usage is not possible.\n *\n * Always uses path-based data attributes (data-locatorjs) for React Server\n * Component compatibility, working without requiring window.__LOCATOR_DATA__.\n *\n * @example\n * ```js\n * // next.config.js\n * module.exports = {\n *   webpack: (config) => {\n *     config.module.rules.push({\n *       test: /\\.(tsx|ts|jsx|js)$/,\n *       exclude: /node_modules/,\n *       use: [{\n *         loader: '@locator/webpack-loader',\n *         options: { env: 'development' }\n *       }]\n *     });\n *     return config;\n *   }\n * };\n * ```\n */\nfunction locatorLoader(\n  this: LoaderContext<LocatorLoaderOptions>,\n  source: string\n): void {\n  const callback = this.async();\n  const filePath = this.resourcePath;\n\n  // Debug: log that loader is being called (set DEBUG_LOCATOR=1 to enable)\n  if (process.env.DEBUG_LOCATOR) {\n    console.log(`[LocatorLoader] Processing: ${filePath}`);\n  }\n\n  // Skip node_modules and middleware files by default\n  if (filePath.includes(\"node_modules\") || filePath.includes(\"middleware.\")) {\n    callback(null, source);\n    return;\n  }\n\n  const options = this.getOptions();\n\n  try {\n    const result = transformSync(source, {\n      filename: filePath,\n      sourceMaps: true,\n      sourceFileName: filePath,\n      babelrc: false,\n      configFile: false,\n      // Use TypeScript preset to properly parse TS/TSX files\n      presets: [\n        [\n          \"@babel/preset-typescript\",\n          {\n            isTSX: true,\n            allExtensions: true,\n            onlyRemoveTypeImports: true,\n          },\n        ],\n      ],\n      // Apply the locator plugin with path-based data attributes for server components\n      plugins: [[locatorPlugin, { ...options, dataAttribute: \"path\" }]],\n      // Preserve the original code structure\n      retainLines: false,\n      compact: false,\n    });\n\n    if (!result || !result.code) {\n      callback(null, source);\n      return;\n    }\n\n    callback(null, result.code, result.map || undefined);\n  } catch (error) {\n    // If transformation fails, return original source and log warning\n    console.warn(\n      `[@bakdotdev/dev-tools/webpack-loader] Failed to transform ${filePath}:`,\n      error instanceof Error ? error.message : String(error)\n    );\n    callback(null, source);\n  }\n}\n\nexport default locatorLoader;\n"],
  "mappings": "AAAA,SAAS,qBAAqB;AAC9B,OAAO,mBAAmB;AAmD1B,SAAS,cAEP,QACM;AACN,QAAM,WAAW,KAAK,MAAM;AAC5B,QAAM,WAAW,KAAK;AAGtB,MAAI,QAAQ,IAAI,eAAe;AAC7B,YAAQ,IAAI,+BAA+B,QAAQ,EAAE;AAAA,EACvD;AAGA,MAAI,SAAS,SAAS,cAAc,KAAK,SAAS,SAAS,aAAa,GAAG;AACzE,aAAS,MAAM,MAAM;AACrB;AAAA,EACF;AAEA,QAAM,UAAU,KAAK,WAAW;AAEhC,MAAI;AACF,UAAM,SAAS,cAAc,QAAQ;AAAA,MACnC,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,gBAAgB;AAAA,MAChB,SAAS;AAAA,MACT,YAAY;AAAA;AAAA,MAEZ,SAAS;AAAA,QACP;AAAA,UACE;AAAA,UACA;AAAA,YACE,OAAO;AAAA,YACP,eAAe;AAAA,YACf,uBAAuB;AAAA,UACzB;AAAA,QACF;AAAA,MACF;AAAA;AAAA,MAEA,SAAS,CAAC,CAAC,eAAe,EAAE,GAAG,SAAS,eAAe,OAAO,CAAC,CAAC;AAAA;AAAA,MAEhE,aAAa;AAAA,MACb,SAAS;AAAA,IACX,CAAC;AAED,QAAI,CAAC,UAAU,CAAC,OAAO,MAAM;AAC3B,eAAS,MAAM,MAAM;AACrB;AAAA,IACF;AAEA,aAAS,MAAM,OAAO,MAAM,OAAO,OAAO,MAAS;AAAA,EACrD,SAAS,OAAO;AAEd,YAAQ;AAAA,MACN,6DAA6D,QAAQ;AAAA,MACrE,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;AAAA,IACvD;AACA,aAAS,MAAM,MAAM;AAAA,EACvB;AACF;AAEA,IAAO,yBAAQ;",
  "names": []
}
