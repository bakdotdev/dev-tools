{
  "version": 3,
  "sources": ["../src/webpack-loader.ts"],
  "sourcesContent": ["import { transformSync } from \"@babel/core\";\nimport presetTypescript from \"@babel/preset-typescript\";\nimport locatorPlugin from \"./babel-jsx/index.js\";\n\ninterface LocatorLoaderOptions {\n  env?: string;\n  ignoreComponentNames?: string[];\n}\n\ninterface LoaderContext<T = Record<string, unknown>> {\n  getOptions(): T;\n  resourcePath: string;\n}\n\n/**\n * Webpack/Turbopack loader for @bakdotdev/dev-tools babel-jsx plugin\n *\n * This loader applies the LocatorJS babel transformation to JSX/TSX files,\n * enabling component location tracking for click-to-source functionality.\n *\n * Works with both Webpack and Turbopack (Next.js).\n *\n * @example\n * ```js\n * // next.config.js (Turbopack)\n * module.exports = {\n *   turbopack: {\n *     rules: {\n *       '*.tsx': {\n *         loaders: [{\n *           loader: '@bakdotdev/dev-tools/webpack-loader',\n *           options: { env: 'development' }\n *         }],\n *       },\n *       '*.jsx': {\n *         loaders: [{\n *           loader: '@bakdotdev/dev-tools/webpack-loader',\n *           options: { env: 'development' }\n *         }],\n *       },\n *     },\n *   },\n * };\n * ```\n */\nfunction locatorLoader(\n  this: LoaderContext<LocatorLoaderOptions>,\n  source: string\n): string {\n  const filePath = this.resourcePath;\n\n  // Debug: log that loader is being called (set DEBUG_LOCATOR=1 to enable)\n  if (process.env.DEBUG_LOCATOR) {\n    console.log(`[LocatorLoader] Processing: ${filePath}`);\n  }\n\n  // Skip node_modules and middleware files by default\n  if (filePath.includes(\"node_modules\") || filePath.includes(\"middleware.\")) {\n    return source;\n  }\n\n  const options = this.getOptions();\n\n  try {\n    const result = transformSync(source, {\n      filename: filePath,\n      sourceMaps: false,\n      sourceFileName: filePath,\n      babelrc: false,\n      configFile: false,\n      // Use TypeScript preset with direct import (not string name)\n      // This ensures the preset is bundled and doesn't require runtime resolution\n      presets: [\n        [\n          presetTypescript,\n          {\n            isTSX: true,\n            allExtensions: true,\n            onlyRemoveTypeImports: true,\n          },\n        ],\n      ],\n      // Apply the locator plugin with path-based data attributes\n      plugins: [[locatorPlugin, { ...options, dataAttribute: \"path\" }]],\n      retainLines: false,\n      compact: false,\n    });\n\n    if (!result || !result.code) {\n      return source;\n    }\n\n    return result.code;\n  } catch (error) {\n    // If transformation fails, return original source and log warning\n    console.warn(\n      `[@bakdotdev/dev-tools/webpack-loader] Failed to transform ${filePath}:`,\n      error instanceof Error ? error.message : String(error)\n    );\n    return source;\n  }\n}\n\nexport default locatorLoader;\n"],
  "mappings": "AAAA,SAAS,qBAAqB;AAC9B,OAAO,sBAAsB;AAC7B,OAAO,mBAAmB;AA2C1B,SAAS,cAEP,QACQ;AACR,QAAM,WAAW,KAAK;AAGtB,MAAI,QAAQ,IAAI,eAAe;AAC7B,YAAQ,IAAI,+BAA+B,QAAQ,EAAE;AAAA,EACvD;AAGA,MAAI,SAAS,SAAS,cAAc,KAAK,SAAS,SAAS,aAAa,GAAG;AACzE,WAAO;AAAA,EACT;AAEA,QAAM,UAAU,KAAK,WAAW;AAEhC,MAAI;AACF,UAAM,SAAS,cAAc,QAAQ;AAAA,MACnC,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,gBAAgB;AAAA,MAChB,SAAS;AAAA,MACT,YAAY;AAAA;AAAA;AAAA,MAGZ,SAAS;AAAA,QACP;AAAA,UACE;AAAA,UACA;AAAA,YACE,OAAO;AAAA,YACP,eAAe;AAAA,YACf,uBAAuB;AAAA,UACzB;AAAA,QACF;AAAA,MACF;AAAA;AAAA,MAEA,SAAS,CAAC,CAAC,eAAe,EAAE,GAAG,SAAS,eAAe,OAAO,CAAC,CAAC;AAAA,MAChE,aAAa;AAAA,MACb,SAAS;AAAA,IACX,CAAC;AAED,QAAI,CAAC,UAAU,CAAC,OAAO,MAAM;AAC3B,aAAO;AAAA,IACT;AAEA,WAAO,OAAO;AAAA,EAChB,SAAS,OAAO;AAEd,YAAQ;AAAA,MACN,6DAA6D,QAAQ;AAAA,MACrE,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;AAAA,IACvD;AACA,WAAO;AAAA,EACT;AACF;AAEA,IAAO,yBAAQ;",
  "names": []
}
